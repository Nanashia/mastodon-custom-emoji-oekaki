<!DOCTYPE html>
<html lang=ja>
<head>
<meta charset=utf-8>
<title>カスタム絵文字でお絵かきツール</title>
<meta name=viewport content="width=430">

<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css>

<script type=text/javascript src=./app/jquery-3.2.1.min.js></script>
<style type=text/css>a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{height:100%}body{font-size:12px;font-family:sans-serif;background-color:#282c37;color:#fff;height:100%}a{color:#aaf}h1{background-color:#444b5d;padding:5px;margin:2px;font-size:18px;font-weight:700}.container_intro{display:none;text-align:center;background-color:#000;padding:20px}.container_intro h1{padding:20px;margin:5px 5px 20px 5px}.container_intro h2{font-size:20px;margin:10px}.container_intro h3{font-size:14px;margin:10px;padding:10px}.container_loading{display:none;text-align:center;background-color:#000;font-size:32px;padding:20px}.container_loading h1{padding:20px;margin:5px 5px 20px 5px}.instance_info{background-color:#000;font-size:12px;vertical-align:middle;text-align:center}#instance_info_domain{font-size:32px;height:38px;width:300px;margin:0}#instance_info_submit{font-size:28px;width:140px;height:38px;border:1px solid #000;margin:0;padding:0}.container_main{display:none;background-color:#000}.cont_left{float:left;height:645px}#tiles{width:418px;height:428px;padding:4px 4px 4px 4px;background-color:#393f4f}#tiles img{cursor:pointer}#result{width:414px;height:130px;padding:5px;font-size:12px;background-color:#fff}.cont_ret_ctrl{padding:5px;background-color:#666}.cont_ret_ctrl .left{float:left;vertical-align:middle}.cont_ret_ctrl .cont_klg_btn{border:1px solid red}.cont_ret_ctrl .right{text-align:right}.cont_result_count{padding:5px;height:18px;background-color:#000}.cont_right{background-color:#000}.cont_right_top{overflow:hidden;padding:5px;margin:0;background-color:#000;font-size:14px;line-height:14px;vertical-align:middle}#instance_domain{font-weight:700;text-decoration:underline;cursor:pointer}#selected_shortname{text-decoration:underline;cursor:pointer}.cont_right_top .left{float:left;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;margin:5px 0 0 5px}.cont_right_top .left .minibt{cursor:pointer}.cont_right_top .right{text-align:right}#text_search{width:110px}#bt_search_clear{cursor:pointer;margin:0 10px 0 0}#instance_domain{margin:0 5px 0 5px}#selected_shortname{margin:0 5px 0 5px}#emoji_palette{height:600px;padding:5px;margin:0;overflow-y:scroll;border:2px solid #000;background-color:#393f4f}#emoji_palette img{cursor:pointer}.bottom{font-size:10px;padding:10px;text-align:center;background-color:#222}.bottom .fa{font-size:18px}.bottom a{color:#fff;text-decoration:none}</style>


</head>
<body>
<div class=container_intro>
<h1>カスタム絵文字でお絵かきツール</h1>
<div class=instance_info>
<h2>インスタンス</h2>
<div class=instance_info>
<input type=text id=instance_info_domain placeholder=mstdn.jp size=24>　
<input type=submit id=instance_info_submit value=" 開 始 ">
<br>
</div>
<h3>カスタム絵文字APIが使用でき、:blank: 絵文字が定義されている必要があります。</h3>
</div>
</div>

<div class=container_loading>
<h1>カスタム絵文字でお絵かきツール</h1>
絵文字情報をロード中...
</div>

<div class=container_main>
<h1><span id=instance_domain></span> カスタム絵文字でお絵かきツール</h1>
<div class=cont_left>
<div id=tiles></div>
<textarea id=result></textarea>
<div class=cont_ret_ctrl>
<div class=left>
<input type=button id=bt_ret_copy value=コピー> 
<input type=button id=bt_ret_share value=シェア>
 | <input type=button id=bt_load value=読み込み>
<span class=emojimoji_btn></span>
</div>
<div class=right>
<input type=button id=bt_reset value=リセット>
</div>
<div style="clear: both"></div>
</div>
<div class=cont_result_count>文字数: <span id=result_count>0</span></div>
</div>

<div class=cont_right>
<div class=cont_right_top>

<div class=left>

<span id=btn_blank class=minibt><i class="fa fa-square fa-x2" aria-hidden=true></i></span>
<span id=btn_left class=minibt><i class="fa fa-arrow-circle-left fa-x2" aria-hidden=true></i></span>
<span id=btn_right class=minibt><i class="fa fa-arrow-circle-right fa-x2" aria-hidden=true></i></span>
<span id=btn_up class=minibt><i class="fa fa-arrow-circle-up fa-x2" aria-hidden=true></i></span>
<span id=btn_down class=minibt><i class="fa fa-arrow-circle-down fa-x2" aria-hidden=true></i></span>


<span id=selected_shortname>-</span>
</div>

<div class=right>
<input type=text id=text_search placeholder=フィルタ>
<span id=bt_search_clear><i class="fa fa-window-close" aria-hidden=true></i></span>
</div>
<div style="clear: both"></div>
</div>
</div>

<div id=emoji_palette></div>
</div>

<div style=clear:both></div>


<div class=bottom>
<a href=https://github.com/mamemomonga/mastodon-custom-emoji-oekaki target=_blank><i class="fa fa-github" aria-hidden=true></i></a>　
<a href=https://theboss.tech/@mamemomonga target=_blank><i class="fa fa-child" aria-hidden=true></i></a>
　#93 
</div>


<script type=text/javascript>// <![CDATA[
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,g){c!=Array.prototype&&c!=Object.prototype&&(c[h]=g.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var h=0;return $jscomp.iteratorPrototype(function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var g=0,f={next:function(){if(g<c.length){var a=g++;return{value:h(a,c[a]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(c,h,g,f){if(h){g=$jscomp.global;c=c.split(".");for(f=0;f<c.length-1;f++){var a=c[f];a in g||(g[a]={});g=g[a]}c=c[c.length-1];f=g[c];h=h(f);h!=f&&null!=h&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.polyfill("String.fromCodePoint",function(c){return c?c:function(c){for(var g="",f=0;f<arguments.length;f++){var a=Number(arguments[f]);if(0>a||1114111<a||a!==Math.floor(a))throw new RangeError("invalid_code_point "+a);65535>=a?g+=String.fromCharCode(a):(a-=65536,g+=String.fromCharCode(a>>>10&1023|55296),g+=String.fromCharCode(a&1023|56320))}return g}},"es6","es3");
(function(){var c=function(){};c.prototype={regex_escape:function(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},shortcode2elm:function(){var a={};$("#emoji_palette img").each(function(b,e){a[e.dataset.shortcode]=e});return a}};var h=function(a){this.startup_configs=a;this.cb=function(){};this.init()};h.prototype={init:function(){var a=this;a.container=$(".cont_ret_ctrl .left .emojimoji_btn");a.container.empty();a.ems=[];for(var b in a.startup_configs)a.ems[b]=new g(function(b){a.cb(b)},
a.startup_configs[b])},set_apply_callback:function(a){this.cb=a},load:function(a){var b=this;a.each(function(a,e){a=e.dataset.shortcode;for(var d in b.ems){var c=b.ems[d],k=a.match(c.re_shortcode);k&&(a==c.icon.sc&&(c.icon.url=e.src),c.emojis[parseInt(k[1],16)]=a)}});for(var e in b.ems)a=b.ems[e],0<Object.keys(a.emojis).length&&(a.icon.jq=$("<img>",{src:a.icon.url,css:{"vertical-align":"middle","object-fit":"contain",width:24,height:24}}),function(a){a.icon.jq.on("click",function(b){a.convert()})}(a),
b.container.append(a.icon.jq))}};var g=function(a,b){this.prefix=b.prefix;this.h2k=b.h2k?!0:!1;this.icon={sc:b.icon,jq:void 0,url:""};this.re_shortcode=new RegExp("^"+this.prefix+"([0-9a-f]{4})$");this.re_emojimoji=new RegExp(":"+this.prefix+"([0-9a-f]{4}):","mg");this.jq_textarea=$("#result");this.emojis={};this.callback=a;this.text=""};g.prototype={convert:function(){this.text=this.jq_textarea.val();this.text.match(this.re_emojimoji)?this.decode():this.encode()},decode:function(){this.jq_textarea.val(this.text.replace(this.re_emojimoji,
function(a,b){return String.fromCodePoint(parseInt(b,16))}))},encode:function(){for(var a=this,b=a.text.split(/\r\n|\r|\n/),e=function(b){return a.emojis[b]?a.emojis[b]:"blank"},c=[],k=0;k<b.length;k++){var l=[],g;for(g in b[k]){a.cb=function(){};var f=b[k].charCodeAt(g);32==f||12288==f?l.push("blank"):a.h2k&&12353<=f&&12435>=f?l.push(e(f+96)):a.emojis[f]&&l.push(a.emojis[f])}c[k]=l}a.callback(c)}};var f=function(a){this.height=this.width=11;this.util=new c;this.emojimojis=new h([{prefix:"klg",icon:"klg2640",
h2k:!0},{prefix:"nrk",icon:"nrk30ca",h2k:!0}])};f.prototype={run:function(a){var b=this;if(window.location.search){a=window.location;var e=a.search;a.href=a.href.replace(new RegExp(b.util.regex_escape(e)),"")+"#"+e.substring(1)}$("#instance_domain").on("click",function(){b.reset();b.emojimojis.init()});$("#selected_shortname").on("click",function(){b.selected_idom&&window.open(b.selected_idom.src)});$("#bt_search_clear").on("click",function(){$("#text_search").val("")});$("#bt_ret_copy").on("click",
function(){$("#result").focus().select();document.execCommand("copy")});$("#bt_ret_share").on("click",function(){window.open("https://"+b.instance_domain+"/share?text="+encodeURI($("#result").val()))});$("#bt_reset").on("click",function(){b.tiles_reset()});$("#bt_load").on("click",function(){b.tiles_load()});$("#btn_left").on("click",function(){b.tiles_move("left")});$("#btn_right").on("click",function(){b.tiles_move("right")});$("#btn_up").on("click",function(){b.tiles_move("up")});$("#btn_down").on("click",
function(){b.tiles_move("down")});$("#btn_blank").on("click",function(){var a=b.util.shortcode2elm();b.emoji_palette_select(a.blank)});b.emojifetch_active=!1;$("#instance_info_submit").on("click",function(){b.emojifetch_active||b.emojifetch_start()});b.emojimojis.set_apply_callback(function(a){b.tiles_reset();for(var e=0;e<b.height;e++){var c=[];if(a[e]){for(var d=0;d<b.width;d++)c[d]=a[e][d]||"blank";b.tiles_sc[e]=c}}b.tiles_from_sc()});(a=window.location.hash.substring(1)||"")?($("#instance_info_domain").val(a),
b.emojifetch_active||b.emojifetch_start()):b.switch_show_container("intro")},switch_show_container:function(a){var b=["main","loading","intro"],e;for(e in b){var c=b[e];c==a?$(".container_"+c).show():$(".container_"+c).hide()}},reset:function(){this.switch_show_container("intro")},emojifetch_start:function(){var a=this;a.emojifetch_active=!0;a.switch_show_container("loading");a.instance_domain=$("#instance_info_domain").val();$.ajax({type:"GET",url:"https://"+a.instance_domain+"/api/v1/custom_emojis",
success:function(b){a.emojifetch_active=!1;a.emojifetch_success(b)},error:function(b,e,c){a.emojifetch_active=!1;a.switch_show_container("intro");alert("取得失敗")}})},emojifetch_success:function(a){window.location.hash=this.instance_domain;$("#instance_domain").text(this.instance_domain);this.emoji_palette(a);this.tiles();this.switch_show_container("main")},search_update:function(){var a=$("#text_search").val();a!=this.prev_keyword&&(""==a?$("#emoji_palette img").each(function(a,e){$(e).show()}):$("#emoji_palette img").each(function(b,
e){-1!=e.dataset.shortcode.search(a)?$(e).show():$(e).hide()}),this.prev_keyword=a)},tiles_reset:function(){var a=this,b=a.blank_idom.src;$("#tiles img").each(function(e,c){c.src=b;a.tiles_sc[c.dataset.y][c.dataset.x]="blank"});a.result()},tiles_update:function(a){var b=this;b.tiles_reset();$("#tiles img").each(function(c,d){c=d.dataset.x;var e=d.dataset.y;a[e]&&a[e][c]&&(c=a[e][c],d.src=c.src,d.dataset.shortcode=c.dataset.shortcode,b.tiles_sc[d.dataset.y][d.dataset.x]=c.dataset.shortcode)});b.result()},
tiles_from_sc:function(){for(var a=this.util.shortcode2elm(),b=[],c=0;c<this.height;c++){for(var d=[],k=0;k<this.width;k++)d[k]=a[this.tiles_sc[c][k]];b.push(d)}this.tiles_update(b)},tiles_move:function(a){var b=this.tiles_sc;if("left"==a)for(var c in b)b[c].push(b[c].shift());if("right"==a)for(var d in b)b[d].unshift(b[d].pop());"up"==a&&b.push(b.shift());"down"==a&&b.unshift(b.pop());this.tiles_from_sc()},tiles:function(){var a=this;a.tiles_sc=[];$("#tiles").text("");for(var b=0;b<a.height;b++){for(var c=
[],d=0;d<a.width;d++){var k=$(a.blank_idom).clone();k.css({border:"2px solid #333333",margin:"1px"});$(k).attr({"data-x":d,"data-y":b});$("#tiles").append(k);c[d]="blank"}$("#tiles").append($("<br>"));a.tiles_sc[b]=c}$("#tiles img").on("click",function(b){b=b.target;var c=b.dataset.x,e=b.dataset.y;a.selected_idom&&(b.src==a.selected_idom.src?($(b).attr({src:a.blank_idom.src}),a.tiles_sc[e][c]="blank"):($(b).attr({src:a.selected_idom.src}),a.tiles_sc[e][c]=a.selected_idom.dataset.shortcode),a.result())});
a.search_update_interval&&clearInterval(a.search_update_interval);a.search_update_interval=setInterval(function(){a.search_update()},500)},tiles_load:function(){for(var a=this.util.shortcode2elm(),b=[],c=$("#result").val().split(/\r\n|\r|\n/),d=0;d<(c.length>this.height?this.height:c.length);d++){for(var k=c[d].split(/\u200B| /),f=[],g=0;g<(k.length>this.width?this.width:k.length);g++){k[g].replace(/^:/,"").replace(/:$/,"");var h=a[k[g].replace(/^:/,"").replace(/:$/,"")];h&&(f[g]=h)}b[d]=f}this.tiles_update(b)},
emoji_palette:function(a){var b=this;$("#emoji_palette").text("");a.sort(function(a,b){return a.shortcode<b.shortcode?-1:a.shortcode>b.shortcode?1:0});for(var c=0;c<a.length;c++){var d=$("<img>",{src:a[c].url,"data-shortcode":a[c].shortcode,css:{border:"2px solid rgb(57, 63, 79)","object-fit":"contain",width:32,height:32}});$("#emoji_palette").append(d);"blank"==a[c].shortcode&&(b.blank_idom=d[0])}b.blank_idom||alert("このインスタンスには :blank: がないため使用できません");$("#emoji_palette img").on("click",function(a){b.emoji_palette_select(a.target)});
b.emojimojis.load($("#emoji_palette img"))},emoji_palette_select:function(a){a!=this.selected_idom&&($("#selected_shortname").text(":"+a.dataset.shortcode+":"),$(a).css("border","2px solid #FFFFFF"),this.selected_idom=a,this.prev_selected_idom&&$(this.prev_selected_idom).css("border","2px solid rgb(57, 63, 79)"),this.prev_selected_idom=a)},result:function(){for(var a=[],b=!1,c=this.height-1;0<=c;c--){for(var d=[],f=!1,g=this.width-1;0<=g;g--){var h=":"+this.tiles_sc[c][g]+":";":blank:"!=h&&(f=!0);
f&&d.push(h)}0<d.length?b=!0:d.push("​");b&&a.push(d.reverse())}b=[];for(c=a.length-1;0<=c;c--)b.push(a[c].join("​"));a=b.join("\n");b=a.length;c="#000000";500<b&&(c="#FF0000");$(".cont_result_count").css("background-color",c);$("#result_count").text(b);$("#result").val(a)}};window.MstdnCustomEmojiOekaki=f})();

// ]]></script>


<script type=text/javascript>// <![CDATA[
$(function(){ new MstdnCustomEmojiOekaki().run(); });
// ]]></script>

</body>
</html>

